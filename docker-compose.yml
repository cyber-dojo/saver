# This file was generated by ./scripts/create_docker_compose_yml.sh

version: '3.7'

volumes:
  one_k:
    external: true

services:

  client:
    build:
      args: [ COMMIT_SHA ]
      context: ./client
    image: cyberdojo/saver-client:${COMMIT_TAG}
    container_name: test_saver_client
    user: nobody
    env_file: [ .env ]
    read_only: true
    restart: 'no'
    tmpfs: /tmp
    volumes:
      - ./client/source:/app/source:ro
      - ./client/test:/app/test:ro
    depends_on:
      - custom-start-points
      - languages-start-points
      - exercises-start-points
      - server

  server:
    build:
      args: [ COMMIT_SHA ]
      context: .
    image: cyberdojo/saver:${COMMIT_TAG}
    user: saver
    container_name: test_saver_server
    env_file: [ .env ]
    read_only: true
    restart: "no"
    volumes:
      - ./app/source:/app/source:ro
      - ./app/test:/app/test:ro
      - one_k:/one_k:rw
    tmpfs:
      - /cyber-dojo:uid=19663,gid=65533
      - /tmp:uid=19663,gid=65533
    depends_on:
      - custom-start-points
      - languages-start-points
      - exercises-start-points

  custom-start-points:
    image: cyberdojo/custom-start-points:513f842
    container_name: test_saver_custom_start_points
    user: nobody
    env_file: [ .env ]
    read_only: true
    restart: "no"
    tmpfs: /tmp

  languages-start-points:
    image: cyberdojo/languages-start-points:f7e6555
    container_name: test_saver_languages_start_points
    user: nobody
    env_file: [ .env ]
    read_only: true
    restart: "no"
    tmpfs: /tmp

  exercises-start-points:
    image: cyberdojo/exercises-start-points:0d14dad
    container_name: test_saver_exercises_start_points
    user: nobody
    env_file: [ .env ]
    read_only: true
    restart: "no"
    tmpfs: /tmp


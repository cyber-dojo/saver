# This file was auto-generated by ./scripts/create_docker_compose_yml.sh
# It is used by ./scripts/augmented_docker_compose.sh
# which saves a copy of the fully-augmented docker-compose.yml
# generated for each build/up/wait/test command
# in ${ROOT_DIR}/tmp/

version: '3.7'

volumes:
  one_k:
    external: true

services:

  client:
    image: cyberdojo/saver-client:${COMMIT_TAG}
    user: nobody
    build:
      args: [ COMMIT_SHA ]
      context: ./client
    container_name: test_saver_client
    env_file: [ .env ]
    read_only: true
    restart: 'no'
    tmpfs: /tmp
    volumes:
      - ./client/source:/app/source:ro
      - ./client/test:/app/test:ro
    depends_on:
      - custom-start-points
      - server

  server:
    image: cyberdojo/saver:${COMMIT_TAG}
    user: saver
    build:
      args: [ COMMIT_SHA ]
      context: .
    container_name: test_saver_server
    depends_on:
      - custom-start-points
    env_file: [ .env ]
    read_only: true
    restart: "no"
    volumes:
      - ./app/source:/app/source:ro
      - ./app/test:/app/test:ro
      - one_k:/one_k:rw
    tmpfs:
      - /cyber-dojo:uid=19663,gid=65533
      - /tmp:uid=19663,gid=65533


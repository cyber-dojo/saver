
volumes:
  one_k:
    external: true

services:

  client:
    depends_on: [ server ]
    build:
      context: source/client
      args: [ COMMIT_SHA ]
    image: cyberdojo/saver-client:${COMMIT_TAG}
    container_name: test_saver_client
    user: nobody
    env_file: [ .env ]
    read_only: true
    restart: no
    tmpfs: /tmp
    volumes:
      - ./test/client:/saver/test:ro

  server:
    build:
      context: .
      args: [ COMMIT_SHA ]
    image: ${CYBER_DOJO_SAVER_IMAGE}:${COMMIT_TAG}
    user: saver
    container_name: test_saver_server
    env_file: [ .env ]
    read_only: true
    restart: no
    volumes:
      - ./test/server:/saver/test:ro
      - one_k:/one_k:rw
    tmpfs:
      - /cyber-dojo:uid=19663,gid=65533
      - /tmp

